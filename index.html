<!DOCTYPE html>
<html>
  <head>
    <title>Cube</title>
    <style>
      body {
      }
      
      .triangle {
        height: 100vw;
        width: 100vw;
        position: absolute;
        top: 0px;
        left: 0px;
      }
      
      .angles {
        height: 6vw;
        width: 100vw;
        position: absolute;
        top: 94vw;
        left: 0px;
        z-index: 256;
        font-size: 3vw;
      }
    </style>
  </head>
  <body>
    <div id="angles" class="angles"></div>
    <script>
      const camZDisp = 3
      const FOV = [1, 1];
      const dAlpha = 0.1;
      const dBeta = 0.2;
      
      const polygonPoints = [
        [-1, -1, -1],
        [1, -1, -1],
        [-1, 1, -1],
        [1, 1, -1],
        [-1, -1, 1],
        [1, -1, 1],
        [-1, 1, 1],
        [1, 1, 1]
      ];
      
      const polygonTriangles = [
        [0, 1, 3],
        [0, 2, 3],
        [4, 5, 7],
        [4, 6, 7],
        [0, 4, 5],
        [0, 1, 5],
        [2, 6, 7],
        [2, 3, 7],
        [0, 4, 6],
        [0, 2, 6],
        [1, 5, 7],
        [1, 3, 7]
      ];
      
      const polygonNormals = [
        [0, 0, -1],
        [0, 0, -1],
        [0, 0, 1],
        [0, 0, 1],
        [0, -1, 0],
        [0, -1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [-1, 0, 0],
        [-1, 0, 0],
        [1, 0, 0],
        [1, 0, 0]
      ];
      
      const triangleCount = 12;
      
      //-------------------------
      
      var alpha = 0;
      var beta = 0;
      
      function screenVerticesToTriangle(point1, point2, point3) {
        return "polygon(" + String(point1[0]) + "% "+ String(point1[1]) + "%,"
          + String(point2[0]) + "% " + String(point2[1]) + "%,"
          + String(point3[0]) + "% " + String(point3[1]) + "%)";
      }
      
      function mapPointToScreen(point) {
        return [
          point[0] / ((point[2] + camZDisp) * FOV[0]) * 50 + 50,
          point[1] / ((point[2] + camZDisp) * FOV[1]) * 50 + 50
        ];
      }
      
      function rotatePoint(point, angleX, angleY) {
        var sinx = Math.sin(angleX);
        var cosx = Math.cos(angleX);
        var siny = Math.sin(angleY);
        var cosy = Math.cos(angleY);
        return [
          point[0] * cosy + (point[1] * sinx + point[2] * cosx) * siny,
          point[1] * cosx - point[2] * sinx,
          - point[0] * siny + (point[1] * sinx + point[2] * cosx) * cosy
        ];
      }
      
      for (var i = 0; i < triangleCount; i++) {
        var box = document.createElement("div");
        box.setAttribute("class", "triangle");
        box.setAttribute("id", String(i));
        document.body.appendChild(box);
      }
      
      setInterval(function () {
        for (var i = 0; i < triangleCount; i++) {
          var box = document.getElementById(String(i));
          
          var normal = rotatePoint(polygonNormals[i], alpha, beta);
          if (normal[2] > 0) {
            box.style["display"] = "none";
            continue;
          }
          var slant = Math.floor(Math.sin(- normal[1]) * 0x80) + 0x80;
          var slantHexStr = slant.toString(16);
          box.style["background-color"] = "#" + slantHexStr + slantHexStr + slantHexStr;
          box.style["display"] = "block";
          box.style["z-index"] = 0xFFFF - Math.floor(normal[2] * 0xFFFF);
          
          var trianglePoints = polygonTriangles[i];
          
          var triangleCoords = [
            polygonPoints[trianglePoints[0]],
            polygonPoints[trianglePoints[1]],
            polygonPoints[trianglePoints[2]]
          ];
          
          var rotatedTriangleCoords = [
            rotatePoint(triangleCoords[0], alpha, beta),
            rotatePoint(triangleCoords[1], alpha, beta),
            rotatePoint(triangleCoords[2], alpha, beta),
          ];
          
          var mappedPos = [
            mapPointToScreen(rotatedTriangleCoords[0]),
            mapPointToScreen(rotatedTriangleCoords[1]),
            mapPointToScreen(rotatedTriangleCoords[2])
          ];
          
          box.style["clip-path"] = screenVerticesToTriangle(mappedPos[0], mappedPos[1], mappedPos[2]);
        }
        
        alpha = (alpha + dAlpha) % 6.2831853072;
        beta = (alpha + dBeta) % 6.2831853072;
        
        document.getElementById("angles").innerHTML = "alpha: " + String(alpha) + "<br/>beta: " + String(beta);
      }, 30);
    </script>
  </body>
</html>
